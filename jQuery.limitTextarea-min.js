(function(b){var a=function(h,l){var i=h,f=b(i).attr("id"),c="-limitTextarea-",j={shift:{keyCode:16,down:false},ctrl:{keyCode:17,down:false},alt:{keyCode:18,down:false},altgr:{keyCode:225,down:false}},d=["afterInit","afterKeyDown","afterKeyUp","afterMouseDown","afterMouseUp","afterContextMenu","afterCut","afterPaste","afterEmpty","afterNotEmpty","afterWithinLimit","afterReachLimit",];function k(m,e){var e=(e)?true:false;switch(m){case 16:j.shift.down=e;break;case 17:j.ctrl.down=e;break;case 18:j.alt.down=e;break;case 225:j.altgr.down=e;break;}}var g={init:function(){var e=this;if(!e.initialized){b(i).data("limittextareaLimit",(b(i).data("limittextareaLimit"))?b(i).data("limittextareaLimit"):(l&&l.limit)?l.limit:0);b(i).data("limittextareaCharactercount",(b(i).data("limittextareaCharactercount"))?b(i).data("limittextareaCharactercount"):0);b(i).data("limittextareaIsempty",(b(i).data("limittextareaIsempty"))?b(i).data("limittextareaIsempty"):false);b(i).data("limittextareaLimitreached",(b(i).data("limittextareaLimitreached"))?b(i).data("limittextareaLimitreached"):false);e.characterCount();e.drawCounter();e.addStyles();e.initialized=true;}e.afterInit();return e;},drawCounter:function(){var n=this,e=document.createElement("div"),m=document.createElement("span");m.id=f+c+"characterCount";e.id=f+c+"container";e.innerHTML=m.outerHTML+" of "+b(i).data("limittextareaLimit")+" characters remaining";b(i).after(e);n.updateCounter();return n;},addStyles:function(){var e=this;if(!b("#"+f+c+"container").hasClass("limitTextarea")){b("#"+f+c+"container").addClass("limitTextarea");}if(!b("#"+f+c+"container").hasClass("container")){b("#"+f+c+"container").addClass("container");}if(!b("#"+f+c+"characterCount").hasClass("limitTextarea")){b("#"+f+c+"characterCount").addClass("limitTextarea");}if(!b("#"+f+c+"characterCount").hasClass("counterContainer")){b("#"+f+c+"characterCount").addClass("counterContainer");}return e;},updateCounter:function(){var e=this,m=parseInt(b(i).data("limittextareaLimit"))-parseInt(b(i).data("limittextareaCharactercount"));b("#"+f+c+"characterCount").html(m);return e;},onKeyDown:function(m){var u=this,s=m.keyCode,p=String.fromCharCode(s),q=[8,9,16,17,19,20,27,35,36,37,38,39,40,45,46,144,145],v=[35,36,67,86,88,89,90,],e=[35,36,37,38,39,40],n=b.inArray(parseInt(s),q),o=b.inArray(parseInt(s),v),r=b.inArray(parseInt(s),e);if(b(i).data("limittextareaLimitreached")){if(!(j.ctrl.down&&o>=0)&&!(j.shift.down&&r>=0)&&(n<0)){m.preventDefault();}}window.setTimeout(function(){b(i).trigger("afterKeyDown");},0);return u;},onKeyUp:function(n){var m=this,o=n.keyCode,e=String.fromCharCode(o);window.setTimeout(function(){b(i).trigger("afterKeyUp");},0);return m;},onMouseDown:function(m){var e=this;window.setTimeout(function(){b(i).trigger("afterMouseDown");},0);return e;},onMouseUp:function(m){var e=this;window.setTimeout(function(){b(i).trigger("afterMouseUp");},0);return e;},onContextMenu:function(m){var e=this;window.setTimeout(function(){b(i).trigger("afterContextMenu");},0);return e;},onCut:function(m){var e=this;window.setTimeout(function(){b(i).trigger("afterCut");},0);return e;},onPaste:function(m){var e=this;window.setTimeout(function(){b(i).trigger("afterPaste");},0);return e;},onEmpty:function(){var e=this;b(i).data("limittextareaIsempty",true);window.setTimeout(function(){b(i).trigger("afterEmpty");},0);return e;},onNotEmpty:function(){var e=this;b(i).data("limittextareaIsempty",false);window.setTimeout(function(){b(i).trigger("afterNotEmpty");},0);return e;},onWithinLimit:function(m){var e=this;b(i).data("limittextareaLimitreached",false);window.setTimeout(function(){b(i).trigger("afterWithinLimit");},0);return e;},onReachLimit:function(m){var e=this;b(i).data("limittextareaLimitreached",true);b(i).val(b(i).val().substr(0,b(i).data("limittextareaLimit")));if(b(i).data("limittextareaCharactercount")>b(i).data("limittextareaLimit")){b(i).data("limittextareaCharactercount",b(i).data("limittextareaLimit"));}window.setTimeout(function(){b(i).trigger("afterReachLimit");},0);return e;},afterInit:function(){var e=this;return e;},afterKeyDown:function(m){var e=this;return e;},afterKeyUp:function(m){var e=this;return e;},afterMouseDown:function(m){var e=this;return e;},afterMouseUp:function(m){var e=this;return e;},afterContextMenu:function(m){var e=this;return e;},afterCut:function(m){var e=this;return e;},afterPaste:function(m){var e=this;return e;},afterEmpty:function(m){var e=this;return e;},afterNotEmpty:function(m){var e=this;return e;},afterWithinLimit:function(m){var e=this;return e;},afterReachLimit:function(m){var e=this;return e;},characterCount:function(o){var e=this,n=e,m=0;if(o){b(i).data("limittextareaCharactercount",o);}else{b(i).data("limittextareaCharactercount",b(i).val().length);n=b(i).data("limittextareaCharactercount");if(b(i).val().length==0){b(i).trigger("empty");}else{b(i).trigger("notempty");}if(b(i).data("limittextareaLimit")){if(parseInt(b(i).data("limittextareaCharactercount"))+1>parseInt(b(i).data("limittextareaLimit"))){b(i).trigger("reachlimit");}else{b(i).trigger("withinlimit");}}else{}}if(e.initialized){e.updateCounter();}return n;},limit:function(e){return(e)?b(i).data("limittextareaLimit",e):b(i).data("limittextareaLimit");}};if(l){Object.keys(l).each(function(e){var m=l[e];if(b.inArray(e,d)>=0){g[e]=l[e];}});}b(i).on("keydown",function(e){k(e.keyCode,true);g.onKeyDown(e).characterCount();});b(i).on("keyup",function(e){k(e.keyCode);g.onKeyUp(e).characterCount();});b(i).on("mouseDown",function(e){g.afterKeyUp(e).characterCount();});b(i).on("mouseup",function(e){g.onMouseUp(e).characterCount();});b(i).on("contextmenu",function(e){g.onContextMenu(e).characterCount();});b(i).on("cut",function(e){g.onCut(e).characterCount();});b(i).on("paste",function(e){g.onPaste(e).characterCount();});b(i).on("empty",function(e){g.onEmpty(e);});b(i).on("notempty",function(e){g.onNotEmpty(e);});b(i).on("withinlimit",function(e){g.onWithinLimit(e);});b(i).on("reachlimit",function(e){g.onReachLimit(e);});b(i).on("afterKeyDown",function(e){g.afterKeyDown(e);});b(i).on("afterKeyUp",function(e){g.afterKeyUp(e);});b(i).on("afterMouseDown",function(e){g.afterKeyUp(e);});b(i).on("afterMouseUp",function(e){g.afterMouseUp(e);});b(i).on("afterContextMenu",function(e){g.afterContextMenu(e);});b(i).on("afterCut",function(e){g.afterCut(e);});b(i).on("afterPaste",function(e){g.afterPaste(e);});b(i).on("afterEmpty",function(e){g.afterEmpty(e);});b(i).on("afterNotEmpty",function(e){g.afterNotEmpty(e);});b(i).on("afterWithinLimit",function(e){g.afterWithinLimit(e);});b(i).on("afterReachLimit",function(e){g.afterReachLimit(e);});return g;};b.fn.extend({limitTextarea:function(c){if(!b(this).data("limittextarea")){var d=new a(this,c);b(this).data("limittextarea",d);d.init();return this;}else{return b(this).data("limittextarea");}}});})(jQuery);
