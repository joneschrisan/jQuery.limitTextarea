(function(b){var a=function(h,m){var i=h,f=b(i).attr("id"),c="-limitTextarea-",j={shift:{keyCode:16,down:false},ctrl:{keyCode:17,down:false},alt:{keyCode:18,down:false},altgr:{keyCode:225,down:false}},d=["afterInit","afterKeyDown","afterKeyUp","afterMouseDown","afterMouseUp","afterContextMenu","afterCut","afterPaste","afterEmpty","afterNotEmpty","afterWithinLimit","afterReachLimit"],k=["limit","disableContextMenu"];function l(n,e){var e=(e)?true:false;switch(n){case 16:j.shift.down=e;break;case 17:j.ctrl.down=e;break;case 18:j.alt.down=e;break;case 225:j.altgr.down=e;break;}}var g={init:function(){var e=this;if(!e.initialized){b(i).data("limittextareaLimit",(b(i).data("limittextareaLimit"))?b(i).data("limittextareaLimit"):(m&&m.limit)?m.limit:0);b(i).data("limittextareaCharactercount",(b(i).data("limittextareaCharactercount"))?b(i).data("limittextareaCharactercount"):0);b(i).data("limittextareaIsempty",(b(i).data("limittextareaIsempty"))?b(i).data("limittextareaIsempty"):false);b(i).data("limittextareaLimitreached",(b(i).data("limittextareaLimitreached"))?b(i).data("limittextareaLimitreached"):false);b(i).data("limittextareaDisablecontextmenu",(b(i).data("limittextareaDisablecontextmenu"))?b(i).data("limittextareaDisablecontextmenu"):"false");e.characterCount();e.drawCounter();e.addStyles();e.initialized=true;}e.afterInit();return e;},drawCounter:function(){var o=this,e=document.createElement("div"),n=document.createElement("span");n.id=f+c+"characterCount";e.id=f+c+"container";e.innerHTML=n.outerHTML+" of "+b(i).data("limittextareaLimit")+" characters remaining";b(i).after(e);o.updateCounter();return o;},addStyles:function(){var e=this;if(!b("#"+f+c+"container").hasClass("limitTextarea")){b("#"+f+c+"container").addClass("limitTextarea");}if(!b("#"+f+c+"container").hasClass("container")){b("#"+f+c+"container").addClass("container");}if(!b("#"+f+c+"characterCount").hasClass("limitTextarea")){b("#"+f+c+"characterCount").addClass("limitTextarea");}if(!b("#"+f+c+"characterCount").hasClass("counterContainer")){b("#"+f+c+"characterCount").addClass("counterContainer");}return e;},updateCounter:function(){var e=this,n=parseInt(b(i).data("limittextareaLimit"))-parseInt(b(i).data("limittextareaCharactercount"));b("#"+f+c+"characterCount").html(n);return e;},onKeyDown:function(n){var v=this,u=n.keyCode,q=String.fromCharCode(u),r=[8,9,16,17,19,20,27,35,36,37,38,39,40,45,46,144,145],w=[35,36,67,86,88,89,90,],e=[35,36,37,38,39,40],o=b.inArray(parseInt(u),r),p=b.inArray(parseInt(u),w),s=b.inArray(parseInt(u),e);if(b(i).data("limittextareaLimitreached")){if(!(j.ctrl.down&&p>=0)&&!(j.shift.down&&s>=0)&&(o<0)){n.preventDefault();}}window.setTimeout(function(){b(i).trigger("afterKeyDown");},0);return v;},onKeyUp:function(o){var n=this,p=o.keyCode,e=String.fromCharCode(p);window.setTimeout(function(){b(i).trigger("afterKeyUp");},0);return n;},onMouseDown:function(n){var e=this;window.setTimeout(function(){b(i).trigger("afterMouseDown");},0);return e;},onMouseUp:function(n){var e=this;window.setTimeout(function(){b(i).trigger("afterMouseUp");},0);return e;},onContextMenu:function(n){var e=this;if(b(i).data("limittextareaDisablecontextmenu")===true){n.preventDefault();}else{window.setTimeout(function(){b(i).trigger("afterContextMenu");},0);}return e;},onCut:function(n){var e=this;window.setTimeout(function(){b(i).trigger("afterCut");},0);return e;},onPaste:function(n){var e=this;window.setTimeout(function(){e.characterCount();},0);window.setTimeout(function(){b(i).trigger("afterPaste");},0);return e;},onEmpty:function(){var e=this;b(i).data("limittextareaIsempty",true);window.setTimeout(function(){b(i).trigger("afterEmpty");},0);return e;},onNotEmpty:function(){var e=this;b(i).data("limittextareaIsempty",false);window.setTimeout(function(){b(i).trigger("afterNotEmpty");},0);return e;},onWithinLimit:function(n){var e=this;b(i).data("limittextareaLimitreached",false);window.setTimeout(function(){b(i).trigger("afterWithinLimit");},0);return e;},onReachLimit:function(n){var e=this;b(i).data("limittextareaLimitreached",true);b(i).val(b(i).val().substr(0,b(i).data("limittextareaLimit")));if(b(i).data("limittextareaCharactercount")>b(i).data("limittextareaLimit")){b(i).data("limittextareaCharactercount",b(i).data("limittextareaLimit"));}window.setTimeout(function(){b(i).trigger("afterReachLimit");},0);return e;},afterInit:function(){var e=this;return e;},afterKeyDown:function(n){var e=this;return e;},afterKeyUp:function(n){var e=this;return e;},afterMouseDown:function(n){var e=this;return e;},afterMouseUp:function(n){var e=this;return e;},afterContextMenu:function(n){var e=this;return e;},afterCut:function(n){var e=this;return e;},afterPaste:function(n){var e=this;return e;},afterEmpty:function(n){var e=this;return e;},afterNotEmpty:function(n){var e=this;return e;},afterWithinLimit:function(n){var e=this;return e;},afterReachLimit:function(n){var e=this;return e;},characterCount:function(p){var e=this,o=e,n=0;if(p){b(i).data("limittextareaCharactercount",p);}else{b(i).data("limittextareaCharactercount",b(i).val().length);o=b(i).data("limittextareaCharactercount");if(b(i).data("limittextareaCharactercount")==0){b(i).trigger("empty");}else{b(i).trigger("notempty");}if(b(i).data("limittextareaLimit")){if(parseInt(b(i).data("limittextareaCharactercount"))+1>parseInt(b(i).data("limittextareaLimit"))){b(i).trigger("reachlimit");}else{b(i).trigger("withinlimit");}}else{}}if(e.initialized){e.updateCounter();}return o;},limit:function(e){return(e)?b(i).data("limittextareaLimit",e):b(i).data("limittextareaLimit");},disableContextMenu:function(e){return(e)?b(i).data("limittextareaDisablecontextmenu",e):b(i).data("limittextareaDisablecontextmenu");}};if(m){Object.keys(m).each(function(e){var n=m[e];if(b.inArray(e,d)>=0){g[e]=m[e];}else{if(b.inArray(e,k)>=0){g[e](n);}}});}b(i).on("keydown",function(e){l(e.keyCode,true);g.onKeyDown(e).characterCount();});b(i).on("keyup",function(e){l(e.keyCode);g.onKeyUp(e).characterCount();});b(i).on("mouseDown",function(e){g.afterKeyUp(e).characterCount();});b(i).on("mouseup",function(e){g.onMouseUp(e).characterCount();});b(i).on("contextmenu",function(e){g.onContextMenu(e).characterCount();});b(i).on("cut",function(e){g.onCut(e).characterCount();});b(i).on("paste",function(e){g.onPaste(e).characterCount();});b(i).on("empty",function(e){g.onEmpty(e);});b(i).on("notempty",function(e){g.onNotEmpty(e);});b(i).on("withinlimit",function(e){g.onWithinLimit(e);});b(i).on("reachlimit",function(e){g.onReachLimit(e);});b(i).on("afterKeyDown",function(e){g.afterKeyDown(e);});b(i).on("afterKeyUp",function(e){g.afterKeyUp(e);});b(i).on("afterMouseDown",function(e){g.afterKeyUp(e);});b(i).on("afterMouseUp",function(e){g.afterMouseUp(e);});b(i).on("afterContextMenu",function(e){g.afterContextMenu(e);});b(i).on("afterCut",function(e){g.afterCut(e);});b(i).on("afterPaste",function(e){g.afterPaste(e);});b(i).on("afterEmpty",function(e){g.afterEmpty(e);});b(i).on("afterNotEmpty",function(e){g.afterNotEmpty(e);});b(i).on("afterWithinLimit",function(e){g.afterWithinLimit(e);});b(i).on("afterReachLimit",function(e){g.afterReachLimit(e);});return g;};b.fn.extend({limitTextarea:function(c){if(!b(this).data("limittextarea")){var d=new a(this,c);b(this).data("limittextarea",d);d.init();return this;}else{return b(this).data("limittextarea");}}});})(jQuery);
